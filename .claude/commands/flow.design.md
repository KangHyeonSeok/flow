---
agent: agent
---
# Flow Design Prompt

## User Input
```text
$ARGUMENTS
```

---

## 역할

**목표**: 사용자 요구사항을 **구현하지 않고**, 설계 문서와 실행 가능한 backlog 구조로 변환한다.

⚠️ **이 프롬프트에서는 절대 구현하지 않는다.** 설계, 계획, 정리만 수행한다.

---

## 전체 흐름

```
1️⃣ 컨텍스트 수집
    ↓
2️⃣ 설계 문서 생성
    ↓
3️⃣ 설계 리뷰 루프 (승인될 때까지)
    ↓
4️⃣ 기능 단위 태스크 추출
    ↓
5️⃣ backlog 생성
    ↓
6️⃣ 우선순위 판단 및 queue 재정렬
    ↓
7️⃣ 사용자에게 큐 검토 요청 → 종료
```

---

## 단계별 상세

### 1️⃣ 컨텍스트 수집

다음 정보를 수집한다:

- 프로젝트 구조 (`lib/`, `supabase/functions/` 등)
- 기존 유사 기능 (검색으로 확인)
- 공통 패턴 및 제약 (가이드 문서 참조)

**참조 문서**:
- `.github/copilot-instructions.md`
- `docs/DEVELOPMENT_GUIDE.md`
- `docs/guides/FLUTTER_GUIDE.md`
- `docs/guides/edge-functions/README.md`

⚠️ 이 단계에서는 **코드를 수정하지 않는다.**

---

### 2️⃣ 설계 문서 생성

**위치**: `docs/implements/designs/`

**파일명**: 사용자 요구사항을 **짧은 명사형 키워드**로 요약
- 예: `인벤토리_시스템.md`, `NPC_대화_개선.md`

**템플릿**: `.flow/templates/design-template.md`

**필수 섹션**:
1. 기능 개요
2. 목표와 비목표 (범위 / 비범위)
3. 전체 흐름 요약
4. 주요 구성 요소
5. 기능 간 관계 (의존성, 인터페이스)
6. 예상 리스크
7. 기능 분해 (태스크 목록)

설계 문서를 생성한 후 **AI가 승인 스크립트를 실행**하여 사용자 입력을 받는다.

---

### 3️⃣ 설계 리뷰 루프

**승인 스크립트**: `.flow/scripts/approve-design.ps1`

**AI가 수행할 작업**:
1. 설계 문서 요약을 사용자에게 보여준다
2. `run_in_terminal`로 승인 스크립트를 실행한다
3. 스크립트가 사용자 입력을 대기함 (Y 또는 피드백)

**스크립트 실행 결과**:
- **Y 입력**: 설계 문서 Status가 `Approved`로 변경됨 → 4️⃣ 진행
- **피드백 입력**: `feedback-{설계이름}.txt` 파일이 생성됨 → 설계 수정 후 재실행

**AI의 후속 동작**:
- 설계 문서의 Status가 `Approved`면 → 4️⃣ 태스크 추출 진행
- `feedback-*.txt` 파일이 있으면 → 피드백 반영하여 설계 수정 후 다시 스크립트 실행
- **승인 없이 다음 단계로 진행하지 않는다**

⚠️ 승인 확인 방법:
- 설계 문서의 `Status: Approved` 확인
- 또는 스크립트 종료 코드 0 (성공)

---

### 4️⃣ 기능 단위 태스크 추출

승인된 설계 문서를 기준으로:

- 기능 단위로 태스크를 분해한다
- 각 태스크는:
  - **독립적으로 구현 가능**해야 한다
  - **다른 태스크와의 인터페이스가 명확**해야 한다

**분해 기준**:
- 하나의 태스크 = 하나의 `/flow` 실행 단위
- 너무 크면 분리, 너무 작으면 병합

---

### 5️⃣ backlog 생성

각 태스크마다 다음 구조로 기록:

```
docs/backlogs/<task-name>/
 └─ plan.md
```

**plan.md 필수 내용**:

```markdown
# Plan: [태스크 이름]

## 출처 설계 문서
- 설계 문서: `docs/implements/designs/{설계파일}.md`

## 1. 입력 (Inputs)
[필요한 입력]

## 2. 출력 (Outputs)
[산출물]

## 3. 인터페이스

### 제공하는 인터페이스
- [다른 태스크가 사용할 수 있는 API/함수/이벤트]

### 의존하는 인터페이스
- [이 태스크가 필요로 하는 외부 기능]
- [아직 구현 안됨 / 이미 구현됨 표시]

## 4. 검증 방법
[테스트 방법]

## 5. 완료 조건
[Done criteria]
```

⚠️ **인터페이스 섹션은 필수!** 이것이 있어야 태스크 간 연결이 보장된다.

---

### 6️⃣ 우선순위 판단 및 queue 재정렬

**대상**: `docs/backlogs/` 내 `plan.md`가 존재하는 폴더만

**우선순위 결정 기준**:
1. **의존성**: 다른 태스크가 의존하는 태스크가 먼저
2. **인터페이스 제공자**: 인터페이스를 제공하는 쪽이 먼저
3. **복잡도**: 기반 기능(단순)이 응용 기능(복잡)보다 먼저
4. **리스크**: 고위험 항목 조기 검증

**queue 파일 형식**: `docs/backlogs/queue`

```
태스크이름1
태스크이름2
태스크이름3
```

**우선순위 근거 파일**: `docs/backlogs/queue-rationale.md`

```markdown
# Queue 우선순위 근거

| 순서 | 태스크 | 이유 |
|------|--------|------|
| 1 | 태스크1 | 다른 모든 태스크가 의존 |
| 2 | 태스크2 | 태스크1의 인터페이스 사용, 태스크3에 인터페이스 제공 |
| 3 | 태스크3 | 태스크1, 2 완료 후 구현 가능 |
```

---

### 7️⃣ 사용자에게 큐 검토 요청

우선순위가 반영된 queue 내용을 사용자에게 보여준다:

```
📋 Backlog Queue가 생성되었습니다.

| 순서 | 태스크 | 우선순위 이유 |
|------|--------|--------------|
| 1 | 기반_서비스 | 다른 모든 태스크가 의존 |
| 2 | 데이터_모델 | 기반_서비스 사용, UI에 제공 |
| 3 | UI_컴포넌트 | 데이터_모델 필요 |

큐를 확인해주세요. 순서 조정이 필요하면 알려주세요.
조정이 없으면 `/flow`로 순차 실행할 수 있습니다.
```

⚠️ 이 단계에서는 **자동 실행을 시작하지 않는다**.

---

## 절대 금지 사항

1. ❌ 코드 구현 금지
2. ❌ 테스트 실행 금지
3. ❌ 자동 실행 시작 금지
4. ❌ queue 소비 금지
5. ❌ 승인 없이 backlog 생성 금지

---

## 완료 조건

다음 조건을 모두 만족하면 `flow.design`은 종료된다:

- [x] 승인된 설계 문서 1개 이상 존재
- [x] 기능 단위 backlog가 생성됨
- [x] 인터페이스가 포함된 plan.md가 존재함
- [x] 우선순위가 반영된 queue가 생성됨
- [x] 사용자에게 큐 내용이 보고됨

---

## 참조 문서

- 설계 템플릿: `.flow/templates/design-template.md`
- 플랜 템플릿: `.flow/templates/plan-template.md`
- 백로그 위치: `docs/backlogs/`
- 설계 문서 위치: `docs/implements/designs/`